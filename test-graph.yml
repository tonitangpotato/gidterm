metadata:
  project: demo-pipeline
  version: "1.0"

tasks:
  setup:
    description: Install dependencies
    command: "echo '[1/5] resolving packages...' && sleep 1 && echo '[2/5] downloading...' && sleep 1 && echo '[3/5] extracting...' && sleep 1 && echo '[4/5] compiling native deps...' && sleep 1 && echo '[5/5] linking...' && echo 'Setup complete.'"
    status: pending

  build:
    description: Build the project
    command: "echo 'Compiling project...' && sleep 1 && echo 'Compiling core (1/8)' && sleep 0.5 && echo 'Compiling utils (2/8)' && sleep 0.5 && echo 'Compiling parser (3/8)' && sleep 0.5 && echo 'Compiling semantic (4/8)' && sleep 0.5 && echo 'Compiling ui (5/8)' && sleep 0.5 && echo 'Compiling views (6/8)' && sleep 0.5 && echo 'Compiling app (7/8)' && sleep 0.5 && echo 'Compiling main (8/8)' && sleep 0.5 && echo 'warning: unused variable x' && echo 'Finished release target in 4.2s' && echo 'Build complete: 0 errors, 1 warning'"
    status: pending
    depends_on: [setup]

  train_model:
    description: Train ResNet model
    command: "for i in $(seq 1 15); do loss=$(echo \"scale=4; 2.0 - ($i * 0.11)\" | bc); acc=$(echo \"scale=4; 0.4 + ($i * 0.035)\" | bc); echo \"Epoch $i/15 | Loss: $loss | Accuracy: $acc | LR: 0.001\"; sleep 1; done; echo 'Training complete.'"
    status: pending
    depends_on: [setup]
    task_type: ml_training

  test:
    description: Run test suite
    command: "echo 'Running tests...' && sleep 1 && echo 'test core::graph ... ok' && sleep 0.3 && echo 'test semantic::parser ... ok' && sleep 0.3 && echo 'test ui::dashboard ... ok' && sleep 0.3 && echo 'test integration::e2e ... ok' && sleep 0.3 && echo '' && echo 'test result: ok. 4 passed; 0 failed; 0 ignored' && echo 'Tests complete.'"
    status: pending
    depends_on: [build]

  deploy:
    description: Deploy to production
    command: "echo 'Deploying...' && echo '10% uploading assets' && sleep 1 && echo '30% pushing container' && sleep 1 && echo '50% running migrations' && sleep 1 && echo '70% health check' && sleep 1 && echo '90% switching traffic' && sleep 1 && echo '100% done' && echo 'Deployed successfully.'"
    status: pending
    depends_on: [test, train_model]
